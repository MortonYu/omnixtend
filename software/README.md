# Getting started with OmniXtend platform software

The pre-built binaries are available under *images* directory. If you don't want to the build process, skip to
*Install process* section.

## Pre-requisites

### Toolchain installation:
You need a cross-compiling toolchain to compile RISC-V specific source code on your x86 machine.
If you do not have installed RISC-V toolchain already, you can download from [here](https://toolchains.bootlin.com/releases_riscv64.html).

The toolchain path should also be added your environment path. The toolchain prefix used in this document
assumes that you have installed the toolchain from the above link. If you have a pre-installed toolchain,
please use the correct prefix in *CROSS_COMPILE*.

## Build process

Clone the omnixtend repository to your <WORKDIR> in local machine. All repositories
should be cloned inside <WORKDIR> only.

```
git clone https://github.com/chipsalliance/omnixtend.git
```

### Buildroot

Buildroot is used to generate the root file system for this platform.

```
git clone https://github.com/buildroot/buildroot.git
cd buildroot
git checkout 2019.11-rc3
cp <WORKDIR>/omnixtend/software/patches/buildroot/config_omnixtend_rootfs .config
git am <WORKDIR>/omnixtend/software/patches/buildroot/*.patch
ARCH=riscv CROSS_COMPILE=riscv64-linux- make
cd ..
```

Once the build is successful, the rootfs will be generated under output/images/rootfs.cpio.xz.

### Linux kernel

Here are the steps to build a custom kernel.

```
git clone https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
cd  linux
git checkout v5.4-rc3
git am <WORKDIR>/omnixtend/software/patches/linux/*.patch
ARCH=riscv CROSS_COMPILE=riscv64-linux- make defconfig
ARCH=riscv CROSS_COMPILE=riscv64-linux- make
cd ..
```

The linux kernel loads rootfs as initramfs using the following config.

```
CONFIG_INITRAMFS_SOURCE="../omnixtend/software/images/rootfs.cpio.xz"
```
If you need to build your rootfs or change the rootfs, modify the config if required. 

### OpenSBI

OpenSBI provides the M-mode software implementation for OmniXtend platform.

Steps to build OpenSBI

```
git clone https://github.com/riscv/opensbi.git
cd opensbi
git checkout v0.5
git am <WORKDIR>/omnixtend/software/patches/opensbi/*.patch
ARCH=riscv CROSS_COMPILE=riscv64-linux- make PLATFORM=sifive/vcu118 FW_PAYLOAD_PATH=<WORKDIR>/linux/arch/riscv/boot/Image
```
## Install process
copy the firmware binary generated by OpenSBI to sdcard
```
sudo dd if=<WORKDIR>/opensbi/build/platform/sifive/vcu118/firmware/fw_payload.bin of=/dev/sdc bs=1024
```
N.B. /dev/sdc should be sdcard partition in your host machine.

